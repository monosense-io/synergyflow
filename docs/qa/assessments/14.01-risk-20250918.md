# Risk Profile: Story 14.01 — Test Architecture Scaffolding & Conventions

Date: 2025-09-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 14
- Critical Risks: 1
- High Risks: 6
- Medium Risks: 4
- Low Risks: 3
- Risk Score: 53/100 (normalized from cumulative 67/126)

## Critical Risks Requiring Immediate Attention

### 1. OPS-001: CI flakiness from Testcontainers orchestration

Score: 9 (Critical)
Probability: High — Containers may race on ports, inconsistent reuse, and network startup times.
Impact: High — Failing/flaky pipelines block merges; erode developer trust in tests.
Mitigation:
- Stabilize orchestration: pre-pull images, use reusable containers and dedicated Docker networks, fixed or reserved ports when possible.
- Introduce one‑retry policy with diagnostics; separate flaky report directory (`build/reports/tests/flaky/*`).
- Fail build on new flakies or increased flake count; publish artifacts for triage.
Testing Focus:
- CI job simulation exercising container lifecycle; repeated runs to assess stability.
- Chaos: inject startup delays to ensure resilience of waiting logic.

## Risk Distribution

### By Category

- Technical: 3 (0 critical)
- Security: 2 (0 critical)
- Performance: 2 (0 critical)
- Data: 2 (0 critical)
- Business: 2 (0 critical)
- Operational: 3 (1 critical)

### By Component

- Frontend: 0 risks
- Backend: 6 risks
- Database: 2 risks
- Infrastructure/CI: 6 risks

## Detailed Risk Register

| Risk ID  | Description                                                                 | Probability | Impact | Score | Priority |
|----------|------------------------------------------------------------------------------|-------------|--------|-------|----------|
| OPS-001  | CI flakiness from Testcontainers orchestration                               | High (3)    | High (3) | 9   | Critical |
| TECH-001 | Modulith testing patterns misapplied (false positives/negatives)            | Medium (2)  | High (3) | 6   | High     |
| SEC-001  | Sensitive data or tokens leak into test logs/artifacts                       | Medium (2)  | High (3) | 6   | High     |
| PERF-001 | Testcontainers startup overhead slows CI significantly                       | High (3)    | Medium (2) | 6 | High     |
| DATA-001 | Non‑deterministic seeds/time cause flaky tests                               | High (3)    | Medium (2) | 6 | High     |
| DATA-002 | Use of real‑like/PII samples in fixtures                                     | Medium (2)  | High (3) | 6   | High     |
| BUS-002  | Under‑enforced gates allow quality regressions                               | Medium (2)  | High (3) | 6   | High     |
| TECH-002 | Complex test utilities hinder adoption/consistency                           | Medium (2)  | Medium (2) | 4 | Medium   |
| BUS-001  | Overly strict gates block delivery and increase friction                     | Medium (2)  | Medium (2) | 4 | Medium   |
| OPS-002  | Inconsistent dev environments (no Docker) reduce local test reliability      | Medium (2)  | Medium (2) | 4 | Medium   |
| OPS-003  | Missing Docker image caching inflates build times                            | Medium (2)  | Medium (2) | 4 | Medium   |
| TECH-003 | Contract test scaffolding misaligned with openapi.yaml                       | Low (1)     | Medium (2) | 2 | Low      |
| SEC-002  | Test containers exposed on host network unintentionally                      | Low (1)     | Medium (2) | 2 | Low      |
| PERF-002 | Architecture docs generation adds unnecessary CI overhead                    | Medium (2)  | Low (1) | 2   | Low      |

## Risk-Based Testing Strategy

### Priority 1: Critical/High Risks

- CI stability suite: repeat CI jobs to validate container reuse and startup sequencing; assert zero flakes across N runs.
- Determinism tests: verify fixed clocks and seeded data affect time‑dependent logic consistently.
- Security hygiene: scan test logs for secrets (patterns) and enforce redaction; verify no secret env vars are printed.
- Coverage gate tests: enforce >= 80% overall, >= 90% for critical modules; assert build fails on regression.

### Priority 2: Medium Risks

- Developer environment checks: docs/tests that validate prerequisites and provide fallback (e.g., Colima/Docker Desktop guidance).
- Build performance: measure and trend CI duration; ensure Docker layer cache or registry cache in place.

### Priority 3: Low Risks

- Contract validation smoke: simple schema validations against `docs/api/openapi.yaml` for representative endpoints.
- Limit architecture docs generation to dedicated job; verify it’s optional for PR pipelines.

## Risk Acceptance Criteria

Must fix before production:
- All Critical (score 9) risks.
- High (score 6) affecting security/data/CI stability: SEC-001, DATA-001, DATA-002, PERF-001, TECH-001, BUS-002.

Monitor with thresholds:
- CI duration SLA; flake count trend; coverage regression alarms.

---

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 1
    high: 6
    medium: 4
    low: 3
  highest:
    id: OPS-001
    score: 9
    title: 'CI flakiness from Testcontainers orchestration'
  recommendations:
    must_fix:
      - 'Stabilize Testcontainers orchestration (reusable containers, image pre-pull, dedicated networks)'
      - 'Deterministic clocks/seeds for tests; forbid nondeterministic sources'
      - 'Redact/forbid secrets in test logs; enforce env var policies'
      - 'Enforce coverage >=80% overall, >=90% critical; fail on new flakies'
    monitor:
      - 'Track CI duration trends and flake counts'
      - 'Alert on coverage regressions and increased retry rates'
```

