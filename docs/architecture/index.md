# SynergyFlow Fullstack Architecture Document

## Table of Contents

- [SynergyFlow Fullstack Architecture Document](#table-of-contents)
  - [Change Log](./change-log.md)
  - [1. Introduction](./1-introduction.md)
    - [Starter Template or Existing Project](./1-introduction.md#starter-template-or-existing-project)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [2.1 Technical Summary](./2-high-level-architecture.md#21-technical-summary)
    - [2.2 Platform and Infrastructure Choice](./2-high-level-architecture.md#22-platform-and-infrastructure-choice)
    - [2.3 Repository Structure](./2-high-level-architecture.md#23-repository-structure)
    - [2.4 High Level Architecture Diagram](./2-high-level-architecture.md#24-high-level-architecture-diagram)
    - [2.5 Architectural Patterns](./2-high-level-architecture.md#25-architectural-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [3.1 Technology Stack Table](./3-tech-stack.md#31-technology-stack-table)
  - [3.2 Next.js 15 & React 19 - Why Latest Stable Versions](./32-nextjs-15-react-19-why-latest-stable-versions.md)
    - [3.2.1 Rationale for Next.js 15 & React 19](./32-nextjs-15-react-19-why-latest-stable-versions.md#321-rationale-for-nextjs-15-react-19)
    - [3.2.2 Next.js 15 Major Improvements](./32-nextjs-15-react-19-why-latest-stable-versions.md#322-nextjs-15-major-improvements)
    - [3.2.3 React 19 Major Improvements](./32-nextjs-15-react-19-why-latest-stable-versions.md#323-react-19-major-improvements)
    - [3.2.4 Breaking Changes & Migration Notes](./32-nextjs-15-react-19-why-latest-stable-versions.md#324-breaking-changes-migration-notes)
    - [3.2.5 Recommended Configuration for SynergyFlow](./32-nextjs-15-react-19-why-latest-stable-versions.md#325-recommended-configuration-for-synergyflow)
    - [3.2.6 Development Workflow Improvements](./32-nextjs-15-react-19-why-latest-stable-versions.md#326-development-workflow-improvements)
    - [3.2.7 Migration Checklist for Developers](./32-nextjs-15-react-19-why-latest-stable-versions.md#327-migration-checklist-for-developers)
    - [3.2.8 Why NOT to Use Next.js 14 for New Projects](./32-nextjs-15-react-19-why-latest-stable-versions.md#328-why-not-to-use-nextjs-14-for-new-projects)
  - [3.3 Mandatory Backend Code Templates & Conventions](./33-mandatory-backend-code-templates-conventions.md)
    - [3.3.1 Gradle Dependencies Configuration (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#331-gradle-dependencies-configuration-mandatory)
    - [3.2.2 Lombok Configuration (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#322-lombok-configuration-mandatory)
    - [3.2.3 DTO Template (MANDATORY - Lombok @Value)](./33-mandatory-backend-code-templates-conventions.md#323-dto-template-mandatory-lombok-value)
    - [3.2.4 Entity Template (MANDATORY - Lombok @Entity @Data)](./33-mandatory-backend-code-templates-conventions.md#324-entity-template-mandatory-lombok-entity-data)
    - [3.2.5 MapStruct Mapper Template (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#325-mapstruct-mapper-template-mandatory)
    - [3.2.6 REST Controller Template (MANDATORY - SpringDoc + RFC7807)](./33-mandatory-backend-code-templates-conventions.md#326-rest-controller-template-mandatory-springdoc-rfc7807)
    - [3.2.7 RFC7807 Problem Details Global Exception Handler (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#327-rfc7807-problem-details-global-exception-handler-mandatory)
    - [3.2.8 Custom Exception Classes](./33-mandatory-backend-code-templates-conventions.md#328-custom-exception-classes)
    - [3.2.9 SpringDoc OpenAPI Configuration (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#329-springdoc-openapi-configuration-mandatory)
    - [3.2.10 Service Layer Template (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#3210-service-layer-template-mandatory)
    - [3.2.11 Repository Layer Template (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#3211-repository-layer-template-mandatory)
    - [3.2.12 Domain Event Template (MANDATORY - Java Records)](./33-mandatory-backend-code-templates-conventions.md#3212-domain-event-template-mandatory-java-records)
    - [3.2.13 Event Listener Template (MANDATORY - Spring Modulith)](./33-mandatory-backend-code-templates-conventions.md#3213-event-listener-template-mandatory-spring-modulith)
    - [3.2.14 Testing Templates (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#3214-testing-templates-mandatory)
      - [Unit Test Template (Mockito)](./33-mandatory-backend-code-templates-conventions.md#unit-test-template-mockito)
      - [Integration Test Template](./33-mandatory-backend-code-templates-conventions.md#integration-test-template)
      - [Spring Modulith Verification Test (MANDATORY)](./33-mandatory-backend-code-templates-conventions.md#spring-modulith-verification-test-mandatory)
  - [4. Data Models](./4-data-models.md)
    - [4.1 Incident](./4-data-models.md#41-incident)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.2 Change](./4-data-models.md#42-change)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.3 Task](./4-data-models.md#43-task)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.4 Worklog](./4-data-models.md#44-worklog)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.5 User](./4-data-models.md#45-user)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.6 DecisionReceipt](./4-data-models.md#46-decisionreceipt)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
      - [Relationships](./4-data-models.md#relationships)
    - [4.7 EventPublication (Spring Modulith)](./4-data-models.md#47-eventpublication-spring-modulith)
      - [TypeScript Interface](./4-data-models.md#typescript-interface)
  - [5. API Specification](./5-api-specification.md)
    - [5.1 REST API Overview](./5-api-specification.md#51-rest-api-overview)
    - [5.2 REST API Specification (OpenAPI 3.0)](./5-api-specification.md#52-rest-api-specification-openapi-30)
  - [6. Components](./6-components.md)
    - [6.1 Frontend - Next.js Application](./6-components.md#61-frontend-nextjs-application)
    - [6.2 Backend - Spring Boot Application](./6-components.md#62-backend-spring-boot-application)
    - [6.3 API Gateway - Envoy Gateway](./6-components.md#63-api-gateway-envoy-gateway)
    - [6.4 Policy Engine - OPA Sidecar](./6-components.md#64-policy-engine-opa-sidecar)
    - [6.5 Workflow Engine - Flowable](./6-components.md#65-workflow-engine-flowable)
    - [6.6 Database - PostgreSQL Cluster](./6-components.md#66-database-postgresql-cluster)
    - [6.7 Cache - DragonflyDB Cluster](./6-components.md#67-cache-dragonflydb-cluster)
    - [6.8 Observability Stack](./6-components.md#68-observability-stack)
    - [6.9 Component Diagram (C4 Container Level)](./6-components.md#69-component-diagram-c4-container-level)
  - [7. External APIs](./7-external-apis.md)
    - [7.1 OAuth2/OIDC Provider (Keycloak or Auth0)](./7-external-apis.md#71-oauth2oidc-provider-keycloak-or-auth0)
    - [7.2 1Password (via ExternalSecrets Operator)](./7-external-apis.md#72-1password-via-externalsecrets-operator)
  - [8. Core Workflows](./8-core-workflows.md)
    - [8.1 Incident Creation and SLA Tracking Workflow](./8-core-workflows.md#81-incident-creation-and-sla-tracking-workflow)
    - [8.2 Change Request with Policy-Driven Approval Workflow](./8-core-workflows.md#82-change-request-with-policy-driven-approval-workflow)
    - [8.3 Link-on-Action: Create Related Change from Incident](./8-core-workflows.md#83-link-on-action-create-related-change-from-incident)
    - [8.4 Single-Entry Time Tray Workflow](./8-core-workflows.md#84-single-entry-time-tray-workflow)
  - [9. Database Schema](./9-database-schema.md)
    - [9.1 Schema Organization](./9-database-schema.md#91-schema-organization)
    - [9.2 Core Tables (SQL DDL)](./9-database-schema.md#92-core-tables-sql-ddl)
    - [9.3 Entity-Relationship Diagram](./9-database-schema.md#93-entity-relationship-diagram)
  - [10. Frontend Architecture](./10-frontend-architecture.md)
    - [10.1 Component Architecture](./10-frontend-architecture.md#101-component-architecture)
      - [Component Organization](./10-frontend-architecture.md#component-organization)
      - [Component Template (Client Component Example)](./10-frontend-architecture.md#component-template-client-component-example)
    - [10.2 State Management Architecture](./10-frontend-architecture.md#102-state-management-architecture)
      - [State Structure](./10-frontend-architecture.md#state-structure)
      - [State Management Patterns](./10-frontend-architecture.md#state-management-patterns)
    - [10.3 Routing Architecture](./10-frontend-architecture.md#103-routing-architecture)
      - [Route Organization](./10-frontend-architecture.md#route-organization)
      - [Protected Route Pattern](./10-frontend-architecture.md#protected-route-pattern)
    - [10.4 Frontend Services Layer](./10-frontend-architecture.md#104-frontend-services-layer)
      - [API Client Setup](./10-frontend-architecture.md#api-client-setup)
      - [Service Example](./10-frontend-architecture.md#service-example)
  - [11. Backend Architecture](./11-backend-architecture.md)
    - [11.1 Service Architecture (Spring Boot Modular Monolith)](./11-backend-architecture.md#111-service-architecture-spring-boot-modular-monolith)
      - [Module Organization](./11-backend-architecture.md#module-organization)
      - [Controller Template (REST API)](./11-backend-architecture.md#controller-template-rest-api)
    - [11.2 Database Architecture](./11-backend-architecture.md#112-database-architecture)
      - [Data Access Layer (Spring Data JPA)](./11-backend-architecture.md#data-access-layer-spring-data-jpa)
      - [JPA Entity Example](./11-backend-architecture.md#jpa-entity-example)
      - [Service Layer with Event Publishing](./11-backend-architecture.md#service-layer-with-event-publishing)
    - [11.3 Authentication and Authorization](./11-backend-architecture.md#113-authentication-and-authorization)
      - [Auth Flow (OAuth2 Resource Server)](./11-backend-architecture.md#auth-flow-oauth2-resource-server)
      - [Security Configuration](./11-backend-architecture.md#security-configuration)
      - [Authorization Middleware (OPA Integration)](./11-backend-architecture.md#authorization-middleware-opa-integration)
  - [12. Deployment Architecture & Infrastructure](./12-deployment-architecture-infrastructure.md)
    - [12.1 Kubernetes Deployment Manifests](./12-deployment-architecture-infrastructure.md#121-kubernetes-deployment-manifests)
      - [Backend Deployment](./12-deployment-architecture-infrastructure.md#backend-deployment)
      - [Frontend Deployment](./12-deployment-architecture-infrastructure.md#frontend-deployment)
      - [Envoy Gateway Configuration](./12-deployment-architecture-infrastructure.md#envoy-gateway-configuration)
    - [12.2 GitOps with Flux CD](./12-deployment-architecture-infrastructure.md#122-gitops-with-flux-cd)
      - [Flux Configuration](./12-deployment-architecture-infrastructure.md#flux-configuration)
      - [Environment Overlays](./12-deployment-architecture-infrastructure.md#environment-overlays)
  - [13. Monitoring and Observability](./13-monitoring-and-observability.md)
    - [13.1 Metrics Collection (Victoria Metrics + Grafana)](./13-monitoring-and-observability.md#131-metrics-collection-victoria-metrics-grafana)
      - [Victoria Metrics Scrape Configuration](./13-monitoring-and-observability.md#victoria-metrics-scrape-configuration)
      - [Grafana Dashboard (API Performance)](./13-monitoring-and-observability.md#grafana-dashboard-api-performance)
    - [13.2 Distributed Tracing (OpenTelemetry)](./13-monitoring-and-observability.md#132-distributed-tracing-opentelemetry)
      - [Spring Boot OpenTelemetry Configuration](./13-monitoring-and-observability.md#spring-boot-opentelemetry-configuration)
  - [14. Testing Strategy](./14-testing-strategy.md)
    - [14.1 Testing Pyramid](./14-testing-strategy.md#141-testing-pyramid)
    - [14.2 Backend Testing](./14-testing-strategy.md#142-backend-testing)
      - [Unit Test Example (JUnit 5 + Mockito)](./14-testing-strategy.md#unit-test-example-junit-5-mockito)
      - [Integration Test (Spring Modulith + Testcontainers)](./14-testing-strategy.md#integration-test-spring-modulith-testcontainers)
    - [14.3 Frontend Testing](./14-testing-strategy.md#143-frontend-testing)
      - [Component Test (Vitest + React Testing Library)](./14-testing-strategy.md#component-test-vitest-react-testing-library)
    - [14.4 E2E Testing (Playwright)](./14-testing-strategy.md#144-e2e-testing-playwright)
  - [15. Error Handling Strategy](./15-error-handling-strategy.md)
    - [15.1 Backend Error Handling (RFC 7807 Problem Details)](./15-error-handling-strategy.md#151-backend-error-handling-rfc-7807-problem-details)
    - [15.2 Frontend Error Handling](./15-error-handling-strategy.md#152-frontend-error-handling)
  - [16. Coding Standards](./16-coding-standards.md)
    - [16.1 Critical Fullstack Rules](./16-coding-standards.md#161-critical-fullstack-rules)
    - [16.2 Naming Conventions](./16-coding-standards.md#162-naming-conventions)
  - [17. Summary & Next Steps](./17-summary-next-steps.md)
    - [17.1 Architecture Summary](./17-summary-next-steps.md#171-architecture-summary)
    - [17.2 Architecture Validation](./17-summary-next-steps.md#172-architecture-validation)
    - [17.3 Implementation Roadmap](./17-summary-next-steps.md#173-implementation-roadmap)
  - [18. UX Specification](./18-ux-specification.md)
    - [18.1 Overview](./18-ux-specification.md#181-overview)
    - [18.2 Design Principles](./18-ux-specification.md#182-design-principles)
    - [18.3 Design Tokens](./18-ux-specification.md#183-design-tokens)
    - [18.4 Component Patterns](./18-ux-specification.md#184-component-patterns)
    - [18.5 Key User Flows](./18-ux-specification.md#185-key-user-flows)
    - [18.6 Responsive Design Strategy](./18-ux-specification.md#186-responsive-design-strategy)
    - [18.7 Accessibility Requirements](./18-ux-specification.md#187-accessibility-requirements)
    - [18.8 Performance Budget (UX Perspective)](./18-ux-specification.md#188-performance-budget-ux-perspective)
    - [18.9 Internationalization (i18n) Considerations](./18-ux-specification.md#189-internationalization-i18n-considerations)
    - [18.10 Error Handling and Empty States](./18-ux-specification.md#1810-error-handling-and-empty-states)
    - [18.11 Loading States and Skeleton Screens](./18-ux-specification.md#1811-loading-states-and-skeleton-screens)
    - [18.12 Animation and Motion](./18-ux-specification.md#1812-animation-and-motion)
    - [18.13 Implementation Checklist](./18-ux-specification.md#1813-implementation-checklist)
    - [18.14 Open Questions and Future Considerations](./18-ux-specification.md#1814-open-questions-and-future-considerations)
  - [Document Status & Approvals](./document-status-approvals.md)
