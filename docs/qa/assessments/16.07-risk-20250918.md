# Risk Profile: Story 16.07 — Frontend App Bootstrap (Next.js 14)

Date: 2025-09-18
Reviewer: Quinn (Test Architect)

## Executive Summary

- Total Risks Identified: 12
- Critical Risks: 0
- High Risks: 4
- Medium Risks: 5
- Low Risks: 3
- Risk Score: 38/100 (normalized from cumulative 50/150)

## Highest Risks

### 1) SEC-001: Insecure session/auth config (NextAuth/OIDC)
Score: 6 (High)
Probability: Medium — Defaults can be permissive during bootstrap.
Impact: High — Session fixation/CSRF/open-redirect issues.
Mitigation:
- Enforce secure cookies in production, `sameSite=lax|strict`, and CSRF checks.
- Lock callback URLs; validate issuer and audience; deny wildcard redirects.
- Secrets via environment only; no repo storage.
Testing Focus:
- E2E auth flow with cookie flags inspection; negative tests for bad redirect.

### 2) OPS-001: E2E test flakiness in CI (Playwright)
Score: 6 (High)
Probability: Medium — Browser/container resources vary in CI.
Impact: High — Unstable pipelines block merges.
Mitigation:
- Headless with deterministic timeouts; retry once with diagnostics.
- Use trace viewer on failure; record video/screenshots; run with workers tuned to CI.
Testing Focus:
- Repeat e2e job N times and assert zero flakes; capture artifacts.

### 3) DATA-001: Secrets exposure via mismanaged .env
Score: 6 (High)
Probability: Medium — Common error during bootstrap.
Impact: High — Credential leak risk.
Mitigation:
- Keep `.env*` ignored; commit `.env.example` only; secret scanning in CI.
- Document local `.env` handling and rotations.
Testing Focus:
- CI secret-scan on PR and main; audit repository history.

### 4) TECH-001: Client bundle bloat (overuse of client components)
Score: 6 (High)
Probability: Medium — App Router misuse is common early on.
Impact: High — Performance and UX degradation.
Mitigation:
- Prefer RSC; mark client components explicitly; establish bundle budgets.
- Lazy-load heavy UI; analyze with `next build --analyze`.
Testing Focus:
- Build size budgets; perf smoke in CI; lighthouse CI optional.

## Risk Distribution

### By Category
- Security: 3 (High: 1)
- Operational: 3 (High: 1)
- Data: 2 (High: 1)
- Technical: 3 (High: 1)
- Performance: 1 (High: 0)

### By Component
- Frontend app: 8
- CI pipeline: 3
- Gateway/SSO integration: 1

## Detailed Risk Register

| Risk ID  | Description                                                        | Probability | Impact | Score | Priority |
|----------|--------------------------------------------------------------------|-------------|--------|-------|----------|
| SEC-001  | Insecure NextAuth/OIDC session/callback settings                   | Medium (2)  | High (3) | 6   | High     |
| OPS-001  | Playwright E2E flakiness in CI                                     | Medium (2)  | High (3) | 6   | High     |
| DATA-001 | Secrets committed or leaked via .env mismanagement                 | Medium (2)  | High (3) | 6   | High     |
| TECH-001 | Client bundle bloat due to client components overuse               | Medium (2)  | High (3) | 6   | High     |
| PERF-001 | Missing query caching leads to redundant network calls             | Medium (2)  | Medium (2) | 4 | Medium   |
| OPS-002  | Node/Playwright version mismatch between dev and CI                | Medium (2)  | Medium (2) | 4 | Medium   |
| BUS-001  | OIDC config misaligned with gateway; auth flows blocked            | Low (1)     | High (3) | 3 | Low      |
| SEC-002  | Open redirect risk on auth callback if validation missing          | Low (1)     | Medium (2) | 2 | Low      |
| A11Y-001 | Missing a11y lint rules reduces accessibility compliance           | Low (1)     | Medium (2) | 2 | Low      |
| TECH-002 | Shadcn/Tailwind config drift; tokens not centralized               | Medium (2)  | Low (1) | 2   | Low      |
| OPS-003  | Uncached install/build steps slow CI                               | Medium (2)  | Medium (2) | 4 | Medium   |
| DATA-002 | Storing PII in localStorage for preferences                        | Low (1)     | Medium (2) | 2 | Low      |

## Risk-Based Testing Strategy

### Priority 1 (High)
- Auth security checks (cookie flags, CSRF, callback validation) via E2E and config unit tests.
- E2E reliability: retries, artifacts, deterministic time; repeat job stability.
- Secret scanning in CI; ensure `.env` rules effective; review history.
- Bundle size budget checks; analyze build stats; enforce thresholds.

### Priority 2 (Medium)
- TanStack Query caching behavior; de-dupe and retry/backoff.
- Node/Playwright version pinning with `.nvmrc`/`engines` and lockfile; cache config in CI.
- CI speed: cache deps and Playwright browsers; split jobs (lint/unit/e2e).

### Priority 3 (Low)
- A11y lint enablement; lighthouse CI optional.
- Preferences storage review (avoid PII in localStorage; use cookies or backend).

## Risk Acceptance Criteria

Must Fix before production enablement:
- SEC-001 (auth/session hardening)
- DATA-001 (secret handling + scanning)
- OPS-001 (E2E reliability baseline)
- TECH-001 (bundle budgets enforced)

Monitor:
- Node/Playwright version drift; CI duration and flake trends; caching efficacy.

---

```yaml
# risk_summary (paste into gate file):
risk_summary:
  totals:
    critical: 0
    high: 4
    medium: 5
    low: 3
  highest:
    id: SEC-001
    score: 6
    title: 'Insecure session/auth config (NextAuth/OIDC)'
  recommendations:
    must_fix:
      - 'Harden NextAuth session/callback config and CSRF protections'
      - 'Secret scanning in CI; commit .env.example only'
      - 'Stabilize Playwright E2E in CI with retries and artifacts'
      - 'Enforce bundle size budgets; prefer RSC and lazy-load heavy UI'
    monitor:
      - 'Pin Node/Playwright versions; cache deps/browsers in CI'
      - 'Track CI duration and flake trends; alert on regressions'
```
